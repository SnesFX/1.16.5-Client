/*
 * Decompiled with CFR 0.146.
 * 
 * Could not load the following classes:
 *  javax.annotation.Nullable
 */
package net.minecraft.world.item;

import java.util.List;
import javax.annotation.Nullable;
import net.minecraft.core.NonNullList;
import net.minecraft.core.Registry;
import net.minecraft.nbt.CompoundTag;
import net.minecraft.nbt.ListTag;
import net.minecraft.nbt.Tag;
import net.minecraft.network.chat.Component;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.world.item.CreativeModeTab;
import net.minecraft.world.item.Item;
import net.minecraft.world.item.ItemStack;
import net.minecraft.world.item.Items;
import net.minecraft.world.item.TooltipFlag;
import net.minecraft.world.item.enchantment.Enchantment;
import net.minecraft.world.item.enchantment.EnchantmentCategory;
import net.minecraft.world.item.enchantment.EnchantmentInstance;
import net.minecraft.world.level.ItemLike;
import net.minecraft.world.level.Level;

public class EnchantedBookItem
extends Item {
    public EnchantedBookItem(Item.Properties properties) {
        super(properties);
    }

    @Override
    public boolean isFoil(ItemStack itemStack) {
        return true;
    }

    @Override
    public boolean isEnchantable(ItemStack itemStack) {
        return false;
    }

    public static ListTag getEnchantments(ItemStack itemStack) {
        CompoundTag compoundTag = itemStack.getTag();
        if (compoundTag != null) {
            return compoundTag.getList("StoredEnchantments", 10);
        }
        return new ListTag();
    }

    @Override
    public void appendHoverText(ItemStack itemStack, @Nullable Level level, List<Component> list, TooltipFlag tooltipFlag) {
        super.appendHoverText(itemStack, level, list, tooltipFlag);
        ItemStack.appendEnchantmentNames(list, EnchantedBookItem.getEnchantments(itemStack));
    }

    public static void addEnchantment(ItemStack itemStack, EnchantmentInstance enchantmentInstance) {
        ListTag listTag = EnchantedBookItem.getEnchantments(itemStack);
        boolean bl = true;
        ResourceLocation resourceLocation = Registry.ENCHANTMENT.getKey(enchantmentInstance.enchantment);
        for (int i = 0; i < listTag.size(); ++i) {
            CompoundTag compoundTag = listTag.getCompound(i);
            ResourceLocation resourceLocation2 = ResourceLocation.tryParse(compoundTag.getString("id"));
            if (resourceLocation2 == null || !resourceLocation2.equals(resourceLocation)) continue;
            if (compoundTag.getInt("lvl") < enchantmentInstance.level) {
                compoundTag.putShort("lvl", (short)enchantmentInstance.level);
            }
            bl = false;
            break;
        }
        if (bl) {
            CompoundTag compoundTag = new CompoundTag();
            compoundTag.putString("id", String.valueOf(resourceLocation));
            compoundTag.putShort("lvl", (short)enchantmentInstance.level);
            listTag.add(compoundTag);
        }
        itemStack.getOrCreateTag().put("StoredEnchantments", listTag);
    }

    public static ItemStack createForEnchantment(EnchantmentInstance enchantmentInstance) {
        ItemStack itemStack = new ItemStack(Items.ENCHANTED_BOOK);
        EnchantedBookItem.addEnchantment(itemStack, enchantmentInstance);
        return itemStack;
    }

    @Override
    public void fillItemCategory(CreativeModeTab creativeModeTab, NonNullList<ItemStack> nonNullList) {
        block4 : {
            block3 : {
                if (creativeModeTab != CreativeModeTab.TAB_SEARCH) break block3;
                for (Enchantment enchantment : Registry.ENCHANTMENT) {
                    if (enchantment.category == null) continue;
                    for (int i = enchantment.getMinLevel(); i <= enchantment.getMaxLevel(); ++i) {
                        nonNullList.add(EnchantedBookItem.createForEnchantment(new EnchantmentInstance(enchantment, i)));
                    }
                }
                break block4;
            }
            if (creativeModeTab.getEnchantmentCategories().length == 0) break block4;
            for (Enchantment enchantment : Registry.ENCHANTMENT) {
                if (!creativeModeTab.hasEnchantmentCategory(enchantment.category)) continue;
                nonNullList.add(EnchantedBookItem.createForEnchantment(new EnchantmentInstance(enchantment, enchantment.getMaxLevel())));
            }
        }
    }
}

